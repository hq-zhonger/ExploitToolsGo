package main

import (
	"fmt"
	"github.com/gookit/color"
	"github.com/hq-zhonger/ExploitToolsGo"
	"log"
	"strings"
	"sync"
	"time"
)

func testCms() {
	var exploit ExploitToolsGo.ExploitToolsGo
	results, errs := exploit.Cms.ThinkPHP.SetUrl("http://198.23.137.158:8080/").ScanAllExploits()

	for {
		select {
		case err, ok := <-errs:
			if !ok {
				return
			} else {
				color.Redln(err)
			}
		case result, ok := <-results:
			if !ok {
				return
			} else {
				if strings.Contains(result, "[+]") {
					color.Greenln(result)
				} else {
					color.Yellowln(result)
				}
			}
		}
	}
}

func testFinger() {
	var exploit ExploitToolsGo.ExploitToolsGo
	finger, err := exploit.Finger.Web.SetUrl("https://www.baidu.com").ScanAllExploits()
	if err != nil {
		log.Fatalln(err)
	}
	fmt.Println(finger)
}

func testOS() {
	var exploit ExploitToolsGo.ExploitToolsGo
	var wg sync.WaitGroup
	for i := 1; i <= 65536; i++ {
		go func() {
			wg.Add(1)
			ip, port, status, server, version := exploit.Finger.OS.Scan("127.0.0.1", i, 5*time.Second)
			fmt.Println(ip, port, status, server, version)
			wg.Done()
		}()
	}
	wg.Wait()
}

func main() {
	//testCms()
	//testFinger()
	testOS()
}
